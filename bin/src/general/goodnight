#!/bin/sh

if [ "$#" -ne 1 ]; then
  echo "The number of the argument is invalid." >&2
  exit 1
fi

if [ "$(ps aux | grep "play /home/ubuntu/sleep/" | grep -v grep)" ]; then
  ps aux | grep "play /home/ubuntu/sleep/" | grep -v grep | awk '{ print $2 }' | xargs kill -2
fi

if [ "$1" = "stop" ]; then
  exit 0
fi

if ! [ -e "$1" ]; then
  echo "No such file or directory" >&2
  exit 1
fi

# On iOS Shortcuts (Run script over SSH), The following command does
# not end until the sound source ends even though running in the background
#
#   play -q ~/sleep.mp3 &
#
# I don't know why it does not go well, and also don't know the
# following goes well
#
#   play ~/sleep.mp3 > /dev/null 2>&1 &
#
# cf. https://askubuntu.com/questions/176038/how-can-i-play-a-song-in-the-background-via-my-command-line#answer-1025636
#
play "$1" > /dev/null 2>&1 &
